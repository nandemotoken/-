<!DOCTYPE html>
<html lang="ja">
        <head>
                <meta charset="UTF-8">
                <title>ReiwaToken front-end</title>
                <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
                <script language="javascript" type="text/javascript" src="web3.min.js"></script>
                <script language="javascript" type="text/javascript" src="./reiwa_abi.js"></script>
        </head>
        <body>
                <h1>令和トークン配布サイト</h1>
                <div id="front"></div>
                <img id="reiwaimg" src="reiwa_100_100.png" <img id="reiwaimg" src="reiwa_100_100.png" >
                <button type="button" id="button_set">残高チェック</button><!-- 追加 -->
                <h4>reiwatoken@gmail.com</h4>
        <script>
          window.addEventListener('load', function() {
                  var reiwatoken;
                  var userAccount;
                  var addr = web3.eth.accounts[0]

                  function startApp() {
                          //コントラクト読込
                          var reiwaAddress = "0xeADCFa3A680324C0d981B73DE1EE7e30D7865415";
                          reiwatoken = web3.eth.contract(reiwaABI).at(reiwaAddress);


                          //ユーザーの登録
                          web3.eth.getAccounts(function(err, accounts) {
                                  console.log(accounts[0]);
                                  userAccount = accounts[0];
                          });



                          //コントラクトから内容の取得
                          reiwatoken.symbol.call({from: addr}, function(err, symbol) {
                                  //ABI expects string here,
                                  if(err) { console.log(err) }
                                  console.log('Token symbol: ' + symbol)
                          })


                          document.getElementById("button_set").onclick = () => {
                                  getAmount();
                          }

                          document.getElementById('reiwaimg').onclick = () =>{
                                  imgClick();
                          }

                  }


                  function getAmount(){
                          return reiwatoken.balanceOf.call( web3.eth.accounts[0]  , function(err, bal) {
                                  if(err) { console.log(err) }
                                  console.log('you have: ' + bal + 'reiwa token')
                                  alert("令和トークンの保有数"+ bal )
                          })

                  }

                  function imgClick() {
                          alert("令和トークンを取得します");
                          reiwatoken.newToken100({ from:addr} , function (err , txHash) {
                                  if(err) console.error(err)
                                  if (txHash) {
                                          console.log('Transaction sent')
                                          console.dir(txHash)
                                  }
                          });
                  }


                  //MetaMaskがインストールされているかのチェック
                  if (typeof web3 !== 'undefined') {
                          // メタマスクのWeb3のプロバイダを使用する。
                          web3js = new Web3(web3.currentProvider);
                          alert("イーサリアムウォレットを利用します");
                  } else {
                          // メタマスクがインストールされていない場合、メタマス クのインストールを促す
                          alert("イーサリアムウォレットを導入してください(MetaMask等)");
                  }

                  // ユーザーのアプリ開始
                  startApp()
          })
        </script>
        </body>
